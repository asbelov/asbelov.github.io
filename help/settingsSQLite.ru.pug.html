<!--Copyright © 2022. Alexander Belov. Contacts: <asbel@alepiz.com>--><!DOCTYPE html><html lang="ru" xml:lang="ru" xmlns="http://www.w3.org/1999/xhtml"><head><title>Настройки системы хранения конфигурации SQLIte.json</title><link rel="stylesheet" href="../materialize-css/dist/css/materialize.css"><link rel="stylesheet" href="../material-design-icons/material-icons.css"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><meta name="author" content="Alexander Belov &amp;lt;asbel@alepiz.com&amp;gt"><script src="../materialize-css/dist/js/materialize.js"></script><script src="../javascripts/help.js"></script></head><body><header><div class="row"><div class="col s12 m10 offset-m1"><h1>Описание настроек системы хранения конфигурации SQLIte.json</h1></div></div></header><main><div class="row"><div class="col s12 m10 offset-m1"><h3>Описание</h3><p>База данных db.db, на основе встраиваемой СУБД SQLite, используется для хранения конфигурации
ALEPIZ, которая создается для обслуживания инфраструктуры. Например, там хранятся данные об
объектах, свойствах объектов, счетчиках,
подключениях счетчиков к объектам, задачах, пользователях, правах пользователей и т.д.

Обычно обращение к базе данных происходит через файловые операции. Это повышает надежность,
скорость и исключает блокировки при одновременной подаче транзакций.
При необходимости удаленных интеграций с БД, можно использовать сервер БД, встроенный в ALEPIZ.</p><h3>Структура БД</h3><p>Список таблиц БД и краткое описание</p><ul class="browser-default"><li>actionsConfig - хранение пользовательских настроек Веб интерфейса для действий</li><li>counterParameters - параметры коллекторов, которые подключены к счетчикам</li><li>counters - параметры счетчиков</li><li>countersGroups - группы счетчиков</li><li>countersUnits - единицы измерения данных и алгоритмы их преобразований</li><li>countersUpdateEvents - настройки событий для обновления связанных счетчиков</li><li>interactions - настройки взаимодействий объектов в списке объектов в пользовательском интерфейсе</li><li>objects - параметры объектов</li><li>objectsCounters - взаимосвязи счетчиков и объектов</li><li>objectsProperties - свойства объектов</li><li>rightsForActions - пользовательские права на действия</li><li>rightsForObjects - пользовательские права на объекты</li><li>roles - роли пользователей</li><li>tasks - параметры задач</li><li>tasksActions - действия, используемые в задачах</li><li>tasksGroups - группы задач</li><li>tasksGroupsRoles - пользовательские права на группы задач</li><li>tasksParameters - параметры задач</li><li>tasksRunConditions - условия для выполнения задач</li><li>tasksRunConditionsOCIDs - id задачи и object counter ID, от которого зависит условие ее запуска</li><li>userCommunication - настройки средств связи с пользователями</li><li>userCommunicationPriorities - настройки приоритетов средств связи с пользователями</li><li>userCommunicationPriorityDescription - описание приоритетов для средств связи</li><li>users - параметры пользователей</li><li>usersRoles - соответствие пользователей и ролей</li><li>variables - переменные для счетчиков, которые рассчитываются из исторических данных</li><li>variablesExpressions - переменные для счетчиков, которые рассчитываются из других переменных</li></ul><h3>Настройки</h3><ul class="browser-default"><li>path - Относительный путь до базы данных. Например, db/db.db.</li><li>maxVariableNumber - максимальное количество переменных, которое можно использовать в
запросах. В запросах типа SELECT * FROM objects WHERE objects.id IN (1,2,3,4,5,15),
количество переменных (в скобках после IN) в SQLite ограничено значением, которое задается
при компиляции. Если превысить это значение, запрос завершится с ошибкой. Для того, чтобы
этого не происходило в функциях работы с БД встроена проверка на количество передаваемых
переменных, которое задается этим параметром. По умолчанию для ALEPIZ 99.</li><i><a href="https://www.sqlite.org/limits.html" target="_blank">https://www.sqlite.org/limits.html</a></i><li>directAccessToDBFile - (true|false) работать напрямую с файлом базы данных, без
использования сервера БД. Это рекомендованный режим работы. Он позволяет увеличить скорость
и уменьшить количество блокировок БД при записи данных.</li><li>disableServer - (true|false) нужно ли запускать сервер БД, для обслуживания запросов.
Сервер запускается как отдельный поток и может использоваться для внешних интеграций
с ALEPIZ. Если внешних интеграций нет и параметр
directAccessToDBFile установлен в true, то сервер БД не нужен и его можно отключить.</li><li>localAddress - IP адрес к которому будет привязан сервер БД. По умолчанию 127.0.0.1.</li><li>serverAddress - IP адрес, к которому будут подключаться клиенты. По умолчанию 127.0.0.1.</li><li>serverPort - TCP порт, который будет слушать сервер и к которому будут подключаться клиенты.
Например, 10200.</li><li>dbChildrenNum - количество потоков для обслуживания запросов на получение информации из БД
на сервере БД. По умолчанию 0 - соответствует количеству ядер процессоров на сервере.
Для записи данных в БД каждое соединение с сервером БД обслуживает отдельный поток.</li><li>retryAttemptsAfterDBLock - количество попыток записи в БД если БД заблокирована.
По умолчанию 60.</li><li>retryAttemptsPause - пауза между попытками записи в БД, если БД заблокирована.
По умолчанию 500мс.</li><li>slowQueryExecutionTime - максимальное время выполнение SQL запроса, после которого в лог
будет добавлена запись о медленном выполнении запроса. По умолчанию 20000мс.</li><li>maxWalSize - максимальный размер файла журнала (db.db-wal) в байтах, при превышении
которого будет производится операция сжатия журнала с помощью pragma wal_checkpoint(TRUNCATE).
По умолчанию 5242880 (5Mb).</li><li>truncatePeriod - период проверки размера файла журнала в миллисекундах для сжатия.
По умолчанию 60000.</li><li>options - опции для движка БД better-sqlite3</li><ul class="browser-default"><li>verbose - (true|false) выводить в лог все SQL запросы. По умолчанию false.</li><li>readonly - (true|false) работать в режиме только для чтения. В настоящий момент такой режим
поддерживается только движком БД и не поддерживается ALEPIZ. По
умолчанию false.</li><li>fileMustExist - (true|false) если файла БД не существует, не создавать его и возвращать
ошибку. По умолчанию false. В случае ALEPIZ не имеет смысла.</li><li>timeout - количество миллисекунд ожидания при выполнении запросов к заблокированной базе
данных, прежде чем выдать ошибку SQLITE_BUSY. По умолчанию: 5000.</li></ul></ul></div></div></main></body></html>